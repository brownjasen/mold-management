<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>模具精益生产管理系统</title>
  <link rel="icon" href="favicon.ico">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f5f5f5;
    }
    .app-wrapper {
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 200px;
      background: #2c3e50;
      color: white;
      overflow-y: auto;
      box-shadow: 2px 0 8px rgba(0,0,0,0.1);
    }
    .logo {
      padding: 20px;
      font-size: 14px;
      font-weight: bold;
      border-bottom: 1px solid #34495e;
      text-align: center;
    }
    .menu {
      list-style: none;
    }
    .menu-item {
      border-bottom: 1px solid #34495e;
    }
    .menu-link {
      display: block;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
      cursor: pointer;
    }
    .menu-link:hover {
      background: #34495e;
      padding-left: 25px;
    }
    .menu-link.active {
      background: #3498db;
      border-left: 4px solid #e74c3c;
    }
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: white;
      padding: 15px 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      font-size: 24px;
      color: #2c3e50;
    }
    .user-info {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
    .btn {
      padding: 10px 20px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover {
      background: #2980b9;
    }
    .btn-primary {
      background: #27ae60;
    }
    .btn-primary:hover {
      background: #229954;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card h3 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      background: white;
      border-collapse: collapse;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ecf0f1;
    }
    thead {
      background: #ecf0f1;
    }
    tbody tr:hover {
      background: #f8f9fa;
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <!-- 侧边栏菜单 -->
    <div class="sidebar">
      <div class="logo">模具管理系统</div>
      <ul class="menu">
        <li class="menu-item"><a class="menu-link active" onclick="switchPage('dashboard')">📊 仪表盘</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('molds')">🏭 模具管理</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('moldDetail')">📋 模具详情</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('inventory')">📦 库存管理</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('approval')">✔️ 流程审批</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('analytics')">📈 统计分析</a></li>
        <li class="menu-item"><a class="menu-link" onclick="switchPage('settings')">⚙️ 系统设置</a></li>
      </ul>
    </div>

    <!-- 主内容区 -->
    <div class="main-content">
      <div class="header">
        <h1>模具精益生产管理系统</h1>
        <div class="user-info">
          <span>👤 管理员</span>
          <button class="btn" onclick="logout()">退出</button>
        </div>
      </div>

      <div class="content">
        <!-- 仪表盘页面 -->
        <div id="dashboard" class="page active">
          <h2>📊 仪表盘</h2>
          <div class="grid">
            <div class="card">
              <h3>生产中的模具</h3>
              <p style="font-size: 32px; color: #3498db; font-weight: bold;">12</p>
            </div>
            <div class="card">
              <h3>今日完成</h3>
              <p style="font-size: 32px; color: #27ae60; font-weight: bold;">5</p>
            </div>
            <div class="card">
              <h3>待审批</h3>
              <p style="font-size: 32px; color: #e74c3c; font-weight: bold;">3</p>
            </div>
            <div class="card">
              <h3>库存预警</h3>
              <p style="font-size: 32px; color: #f39c12; font-weight: bold;">2</p>
            </div>
          </div>
        </div>

        <!-- 模具管理页面 -->
        <div id="molds" class="page">
          <h2>🏭 模具管理</h2>
          <button class="btn btn-primary" onclick="openCreateModal()">+ 新建模具</button>
          <button class="btn" onclick="switchPage('moldDetail')" style="margin-left: 10px;">查看详情</button>
          
          <table style="margin-top: 20px;">
            <thead>
              <tr>
                <th>模具编号</th>
                <th>下单时间</th>
                <th>进度</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="moldsTable">
              <tr><td colspan="5" style="text-align: center; padding: 40px;">加载中...</td></tr>
            </tbody>
          </table>
        </div>

        <!-- 模具详情页面 -->
        <div id="moldDetail" class="page">
          <h2>📋 模具详情 - SC25-01</h2>
          <div style="background: white; padding: 20px; border-radius: 8px;">
            <!-- 模具基本信息 -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                  <p style="color: #7f8c8d; font-size: 12px;">模具编号</p>
                  <p style="font-weight: bold; color: #2c3e50;">SC25-01</p>
                </div>
                <div>
                  <p style="color: #7f8c8d; font-size: 12px;">下单日期</p>
                  <p style="font-weight: bold; color: #2c3e50;">2025-10-20 08:00</p>
                </div>
                <div>
                  <p style="color: #7f8c8d; font-size: 12px;">预计完成</p>
                  <p style="font-weight: bold; color: #2c3e50;">2025-11-15</p>
                </div>
                <div>
                  <p style="color: #7f8c8d; font-size: 12px;">总体进度</p>
                  <p style="font-weight: bold; color: #3498db;">35.5%</p>
                </div>
              </div>
              <div style="margin-top: 15px; border-top: 1px solid #ecf0f1; padding-top: 15px;">
                <p style="color: #7f8c8d; font-size: 12px; margin-bottom: 8px;">进度条</p>
                <div style="background: #ecf0f1; height: 8px; border-radius: 4px; overflow: hidden;">
                  <div style="background: linear-gradient(90deg, #3498db, #2980b9); height: 100%; width: 35.5%;"></div>
                </div>
              </div>
            </div>
            
            <!-- 6个生产模块 -->
            <div class="grid">
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>🏗️ 模架</h3>
                <p>进度：<strong style="color: #3498db;">30%</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #3498db; height: 100%; width: 30%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">工序：10道</p>
                <p style="font-size: 12px; color: #e74c3c; margin-top: 5px;">⏳ 进行中</p>
                <button class="btn" onclick="viewModuleDetail('moldFrame')" style="margin-top: 10px; width: 100%;">📊 查看详情</button>
              </div>
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>⚙️ 三大件</h3>
                <p>进度：<strong style="color: #f39c12;">20%</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #f39c12; height: 100%; width: 20%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">工序：8道</p>
                <p style="font-size: 12px; color: #f39c12; margin-top: 5px;">⏳ 进行中</p>
                <button class="btn" onclick="viewModuleDetail('threeParts')" style="margin-top: 10px; width: 100%;">📊 查看详情</button>
              </div>
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>📦 辅料</h3>
                <p>进度：<strong style="color: #27ae60;">50%</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #27ae60; height: 100%; width: 50%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">已下单：8件</p>
                <p style="font-size: 12px; color: #27ae60; margin-top: 5px;">✓ 齐备</p>
                <button class="btn" onclick="viewModuleDetail('accessory')" style="margin-top: 10px; width: 100%;">📦 查看库存</button>
              </div>
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>🔧 组装</h3>
                <p>进度：<strong style="color: #95a5a6;">0%</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #95a5a6; height: 100%; width: 0%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">工序：1道</p>
                <p style="font-size: 12px; color: #95a5a6; margin-top: 5px;">⚪ 等待中</p>
                <button class="btn" onclick="viewModuleDetail('assembly')" style="margin-top: 10px; width: 100%;">🔧 查看工序</button>
              </div>
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>🧪 试模</h3>
                <p>进度：<strong style="color: #95a5a6;">0%</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #95a5a6; height: 100%; width: 0%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">工序：3道</p>
                <p style="font-size: 12px; color: #95a5a6; margin-top: 5px;">⚪ 等待中</p>
                <button class="btn" onclick="viewModuleDetail('trial')" style="margin-top: 10px; width: 100%;">🧪 查看工序</button>
              </div>
              <div class="card" style="cursor: pointer; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <h3>🔄 返修</h3>
                <p>返修项：<strong style="color: #27ae60;">0项</strong></p>
                <div style="background: #ecf0f1; height: 4px; border-radius: 2px; margin: 8px 0; overflow: hidden;">
                  <div style="background: #27ae60; height: 100%; width: 0%;"></div>
                </div>
                <p style="font-size: 12px; color: #7f8c8d; margin-top: 10px;">质量状态：良好</p>
                <p style="font-size: 12px; color: #27ae60; margin-top: 5px;">✓ 正常</p>
                <button class="btn btn-primary" onclick="openRepairModal()" style="margin-top: 10px; width: 100%;">申请返修</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 库存管理页面 -->
        <div id="inventory" class="page">
          <h2>📦 库存管理</h2>
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-primary" onclick="alert('入库功能')">📥 入库</button>
            <button class="btn" onclick="alert('出库功能')">📤 出库</button>
            <button class="btn" onclick="alert('库存查询')">🔍 查询</button>
          </div>

          <table>
            <thead>
              <tr>
                <th>品名</th>
                <th>型号</th>
                <th>库存数</th>
                <th>安全库存</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>阀针</td>
                <td>SC-2020A</td>
                <td>150</td>
                <td>200</td>
                <td><span style="background: #ffe6e6; padding: 4px 8px; border-radius: 4px; font-size: 12px;">⚠️ 预警</span></td>
                <td><button class="btn" style="padding: 4px 8px; font-size: 12px;">补货</button></td>
              </tr>
              <tr>
                <td>导柱</td>
                <td>SC-2021A</td>
                <td>300</td>
                <td>200</td>
                <td><span style="background: #e6ffe6; padding: 4px 8px; border-radius: 4px; font-size: 12px;">✅ 正常</span></td>
                <td><button class="btn" style="padding: 4px 8px; font-size: 12px;">编辑</button></td>
              </tr>
              <tr>
                <td>变径弯头</td>
                <td>SC-2020B</td>
                <td>50</td>
                <td>200</td>
                <td><span style="background: #ffcccc; padding: 4px 8px; border-radius: 4px; font-size: 12px;">🔴 严重</span></td>
                <td><button class="btn" style="padding: 4px 8px; font-size: 12px;">补货</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 流程审批页面 -->
        <div id="approval" class="page">
          <h2>✔️ 流程审批</h2>
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn" onclick="alert('待审批项目')" style="background: #e74c3c;">待审批 (3)</button>
            <button class="btn" onclick="alert('已审批项目')" style="background: #27ae60;">已审批 (12)</button>
            <button class="btn" onclick="alert('审批历史')">审批历史</button>
          </div>

          <table>
            <thead>
              <tr>
                <th>模具编号</th>
                <th>审批阶段</th>
                <th>提交人</th>
                <th>提交时间</th>
                <th>状态</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>SC25-01</td>
                <td>工程部审批</td>
                <td>张三</td>
                <td>2025-10-26 10:30</td>
                <td><span style="background: #fff3e0; padding: 4px 8px; border-radius: 4px; font-size: 12px;">⏳ 待审批</span></td>
                <td><button class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;">审批</button></td>
              </tr>
              <tr>
                <td>SC25-02</td>
                <td>质检部审批</td>
                <td>李四</td>
                <td>2025-10-25 14:20</td>
                <td><span style="background: #e6ffe6; padding: 4px 8px; border-radius: 4px; font-size: 12px;">✅ 已通过</span></td>
                <td><button class="btn" style="padding: 4px 8px; font-size: 12px;">查看</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 统计分析页面 -->
        <div id="analytics" class="page">
          <h2>📈 统计分析</h2>
          <div class="grid">
            <div class="card">
              <h3>生产效率</h3>
              <p style="font-size: 24px; color: #3498db;">87.5%</p>
              <p style="font-size: 12px; color: #7f8c8d;">本周平均效率</p>
            </div>
            <div class="card">
              <h3>人员效率</h3>
              <p style="font-size: 24px; color: #27ae60;">92.3%</p>
              <p style="font-size: 12px; color: #7f8c8d;">人员工作效率</p>
            </div>
            <div class="card">
              <h3>质量合格率</h3>
              <p style="font-size: 24px; color: #f39c12;">96.8%</p>
              <p style="font-size: 12px; color: #7f8c8d;">本月合格率</p>
            </div>
            <div class="card">
              <h3>返修率</h3>
              <p style="font-size: 24px; color: #e74c3c;">3.2%</p>
              <p style="font-size: 12px; color: #7f8c8d;">本月返修率</p>
            </div>
          </div>
        </div>

        <!-- 系统设置页面 -->
        <div id="settings" class="page">
          <h2>⚙️ 系统设置</h2>
          <div style="background: white; padding: 20px; border-radius: 8px;">
            <h3>权限管理</h3>
            <p style="margin: 10px 0;">当前用户：管理员</p>
            <button class="btn" onclick="alert('用户管理')">👥 用户管理</button>
            <button class="btn" onclick="alert('角色管理')" style="margin-left: 10px;">🎭 角色管理</button>

            <h3 style="margin-top: 30px;">系统配置</h3>
            <button class="btn" onclick="alert('备份数据')" style="margin-top: 10px;">💾 备份数据</button>
            <button class="btn" onclick="alert('恢复数据')" style="margin-left: 10px;">♻️ 恢复数据</button>
            <button class="btn" onclick="alert('日志查询')" style="margin-left: 10px;">📋 日志查询</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 模块详情模态框 -->
  <div id="moduleModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 8px; max-width: 900px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #ecf0f1; padding-bottom: 15px;">
        <h2 id="moduleTitle" style="color: #2c3e50;">模块详情</h2>
        <button onclick="closeModuleModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">✕</button>
      </div>
      
      <div id="moduleContent" style="color: #2c3e50;"></div>
      
      <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn" onclick="closeModuleModal()" style="background: #95a5a6;">关闭</button>
      </div>
    </div>
  </div>

  <!-- 返修申请模态框 -->
  <div id="repairModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 8px; min-width: 450px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <h2 style="margin-bottom: 20px; color: #2c3e50;">申请返修 - SC25-01</h2>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">返修工件</label>
        <select style="width: 100%; padding: 8px; border: 1px solid #ecf0f1; border-radius: 4px;">
          <option>模架</option>
          <option>三大件</option>
          <option>组装部件</option>
        </select>
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">问题描述</label>
        <textarea style="width: 100%; padding: 8px; border: 1px solid #ecf0f1; border-radius: 4px; resize: vertical; min-height: 80px;" placeholder="详细描述问题..."></textarea>
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">责任人</label>
        <input type="text" style="width: 100%; padding: 8px; border: 1px solid #ecf0f1; border-radius: 4px;" placeholder="请输入负责人名字">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold;">预计费用</label>
        <input type="number" style="width: 100%; padding: 8px; border: 1px solid #ecf0f1; border-radius: 4px;" placeholder="0.00">
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button class="btn btn-primary" onclick="submitRepair()" style="flex: 1;">✓ 提交返修申请</button>
        <button class="btn" onclick="closeRepairModal()" style="flex: 1; background: #95a5a6;">取消</button>
      </div>
    </div>
  </div>

  <script>
    function switchPage(pageName) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageName).classList.add('active');
      document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
      event.target.classList.add('active');
    }

    function openCreateModal() {
      alert('新建模具对话框\n模具编号: SC25-XX\n下单时间: 2025-10-26');
    }

    function logout() {
      alert('已退出系统');
    }

    // 页面加载时加载模具列表
    window.onload = () => {
      loadMolds();
    };

    function loadMolds() {
      const tbody = document.getElementById('moldTable');
      fetch('http://localhost:5000/api/molds/list')
        .then(r => r.json())
        .then(data => {
          if (data.data && data.data.length > 0) {
            tbody.innerHTML = data.data.map(m => `
              <tr>
                <td><strong>${m.moldNumber}</strong></td>
                <td>${new Date(m.orderTime).toLocaleDateString('zh-CN')}</td>
                <td>
                  <div style="background: #ecf0f1; height: 6px; border-radius: 3px; overflow: hidden;">
                    <div style="background: #3498db; height: 100%; width: ${m.overallProgress}%;"></div>
                  </div>
                  <span style="font-size: 12px;">${m.overallProgress}%</span>
                </td>
                <td>${getStatus(m.status)}</td>
                <td>
                  <button class="btn" style="padding: 4px 8px; font-size: 12px;">查看</button>
                  <button class="btn" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;">编辑</button>
                </td>
              </tr>
            `).join('');
          } else {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px;">暂无数据</td></tr>';
          }
        })
        .catch(err => {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #e74c3c;">加载失败：' + err.message + '</td></tr>';
        });
    }

    function getStatus(status) {
      const statuses = {
        'pending': '<span style="background: #ffe6e6; padding: 4px 8px; border-radius: 4px; font-size: 12px;">等待中</span>',
        'in_progress': '<span style="background: #fff3e0; padding: 4px 8px; border-radius: 4px; font-size: 12px;">生产中</span>',
        'completed': '<span style="background: #e6ffe6; padding: 4px 8px; border-radius: 4px; font-size: 12px;">已完成</span>'
      };
      return statuses[status] || status;
    }

    // 模块详情显示
    function viewModuleDetail(moduleType) {
      const modal = document.getElementById('moduleModal');
      const title = document.getElementById('moduleTitle');
      const content = document.getElementById('moduleContent');
      
      const moduleData = {
        moldFrame: {
          title: '🏗️ 模架工序详情',
          content: `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <p><strong>总工序数：10道</strong></p>
              <p>当前进度：30% | 已完成：3道 | 进行中：1道 | 未开始：6道</p>
            </div>
            <div style="margin-top: 15px;">
              <h4 style="margin-bottom: 10px;">工序列表：</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr style="background: #ecf0f1; border-bottom: 1px solid #ddd;">
                  <td style="padding: 10px; font-weight: bold;">序号</td>
                  <td style="padding: 10px; font-weight: bold;">工序名称</td>
                  <td style="padding: 10px; font-weight: bold;">状态</td>
                  <td style="padding: 10px; font-weight: bold;">耗时</td>
                  <td style="padding: 10px; font-weight: bold;">负责人</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">01</td>
                  <td style="padding: 10px;">设计图纸</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓ 完成</span></td>
                  <td style="padding: 10px;">1.5小时</td>
                  <td style="padding: 10px;">王工</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">02</td>
                  <td style="padding: 10px;">模料</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓ 完成</span></td>
                  <td style="padding: 10px;">3小时</td>
                  <td style="padding: 10px;">李工</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">03</td>
                  <td style="padding: 10px;">深孔钻</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓ 完成</span></td>
                  <td style="padding: 10px;">2小时</td>
                  <td style="padding: 10px;">张工</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">04</td>
                  <td style="padding: 10px;">数控铣</td>
                  <td style="padding: 10px;"><span style="background: #fff3e0; padding: 2px 6px; border-radius: 3px; font-size: 12px;">⏳ 进行中</span></td>
                  <td style="padding: 10px;">预计 4小时</td>
                  <td style="padding: 10px;">陈工</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">05-10</td>
                  <td style="padding: 10px;">其他工序（6道）</td>
                  <td style="padding: 10px;"><span style="background: #ffe6e6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">未开始</span></td>
                  <td style="padding: 10px;">待定</td>
                  <td style="padding: 10px;">待分配</td>
                </tr>
              </table>
            </div>
            <div style="margin-top: 15px; background: #e6f7ff; padding: 12px; border-radius: 8px; border-left: 4px solid #3498db;">
              <p style="margin: 0;"><strong>💡 提示：</strong>当前数控铣工序进行中，预计今天17:00完成，随后转入倒角磨床工序。</p>
            </div>
          `
        },
        threeParts: {
          title: '⚙️ 三大件工序详情',
          content: `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <p><strong>总工序数：8道</strong></p>
              <p>当前进度：20% | 已完成：1道 | 进行中：1道 | 未开始：6道</p>
            </div>
            <div style="margin-top: 15px;">
              <h4 style="margin-bottom: 10px;">工序进度：</h4>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <div style="background: #e6ffe6; padding: 10px; border-radius: 4px; text-align: center;">
                  <div style="font-weight: bold;">设计</div>
                  <div style="font-size: 12px; color: #7f8c8d;">✓ 完成</div>
                </div>
                <div style="background: #fff3e0; padding: 10px; border-radius: 4px; text-align: center;">
                  <div style="font-weight: bold;">模料</div>
                  <div style="font-size: 12px; color: #7f8c8d;">⏳ 进行中</div>
                </div>
                <div style="background: #ffe6e6; padding: 10px; border-radius: 4px; text-align: center;">
                  <div style="font-weight: bold;">开粗</div>
                  <div style="font-size: 12px; color: #7f8c8d;">未开始</div>
                </div>
                <div style="background: #ffe6e6; padding: 10px; border-radius: 4px; text-align: center;">
                  <div style="font-weight: bold;">淬火</div>
                  <div style="font-size: 12px; color: #7f8c8d;">未开始</div>
                </div>
              </div>
            </div>
          `
        },
        accessory: {
          title: '📦 辅料库存详情',
          content: `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <p><strong>总品项数：8种</strong></p>
              <p>已齐备：8种 | 采购中：0种 | 超期：0种</p>
            </div>
            <div style="margin-top: 15px;">
              <h4 style="margin-bottom: 10px;">辅料清单：</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr style="background: #ecf0f1; border-bottom: 1px solid #ddd;">
                  <td style="padding: 10px; font-weight: bold;">品名</td>
                  <td style="padding: 10px; font-weight: bold;">规格</td>
                  <td style="padding: 10px; font-weight: bold;">数量</td>
                  <td style="padding: 10px; font-weight: bold;">单价</td>
                  <td style="padding: 10px; font-weight: bold;">状态</td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">铜板</td>
                  <td style="padding: 10px;">2mm</td>
                  <td style="padding: 10px;">2片</td>
                  <td style="padding: 10px;">¥450</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</span></td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">铜导套</td>
                  <td style="padding: 10px;">φ12</td>
                  <td style="padding: 10px;">8个</td>
                  <td style="padding: 10px;">¥120</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</span></td>
                </tr>
                <tr style="border-bottom: 1px solid #ecf0f1;">
                  <td style="padding: 10px;">导柱</td>
                  <td style="padding: 10px;">SK3</td>
                  <td style="padding: 10px;">8根</td>
                  <td style="padding: 10px;">¥280</td>
                  <td style="padding: 10px;"><span style="background: #e6ffe6; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</span></td>
                </tr>
              </table>
              <p style="margin-top: 15px; color: #7f8c8d; font-size: 12px;">💚 所有物料已到货，可安心进行后续工序</p>
            </div>
          `
        },
        assembly: {
          title: '🔧 组装工序详情',
          content: `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <p><strong>总工序数：1道</strong></p>
              <p>当前状态：未开始 | 等待模架工序完成</p>
            </div>
            <div style="margin-top: 15px; background: #fff3e0; padding: 12px; border-radius: 8px; border-left: 4px solid #f39c12;">
              <p style="margin: 0;"><strong>⏳ 提示：</strong>此工序依赖模架和三大件完成，预计11月1日开始。</p>
            </div>
          `
        },
        trial: {
          title: '🧪 试模工序详情',
          content: `
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
              <p><strong>总工序数：3道</strong></p>
              <p>当前状态：未开始 | 等待组装完成</p>
            </div>
            <div style="margin-top: 15px;">
              <h4 style="margin-bottom: 10px;">试模流程：</h4>
              <ol style="margin-left: 20px;">
                <li>初试（检查基本功能）</li>
                <li>加克重抛光（根据克数调整）</li>
                <li>试样品（制作样品件）</li>
              </ol>
            </div>
          `
        }
      };
      
      const data = moduleData[moduleType];
      if (data) {
        title.textContent = data.title;
        content.innerHTML = data.content;
        modal.style.display = 'flex';
      }
    }

    function closeModuleModal() {
      document.getElementById('moduleModal').style.display = 'none';
    }

    function openRepairModal() {
      document.getElementById('repairModal').style.display = 'flex';
    }

    function closeRepairModal() {
      document.getElementById('repairModal').style.display = 'none';
    }

    function submitRepair() {
      alert('✓ 返修申请已提交！\n审批人：质检部长\n预计审批时间：1小时');
      closeRepairModal();
    }

    // 点击空白处关闭模态框
    window.onclick = (e) => {
      if (e.target.id === 'moduleModal') {
        closeModuleModal();
      }
      if (e.target.id === 'repairModal') {
        closeRepairModal();
      }
    };
  </script>
</body>
</html>
